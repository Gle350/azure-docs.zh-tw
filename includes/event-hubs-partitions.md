---
title: 包含檔案
description: 包含檔案
services: event-hubs
author: spelluru
ms.service: event-hubs
ms.topic: include
ms.date: 01/05/2021
ms.author: spelluru
ms.custom: include file
ms.openlocfilehash: 780da47e6f071d854a16ca1d1c5cd02dbdd6bef0
ms.sourcegitcommit: 19ffdad48bc4caca8f93c3b067d1cf29234fef47
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/06/2021
ms.locfileid: "97955634"
---
事件中樞會將事件序列組織成一或多個分割區。 當較新的事件送達時，系統會將其新增至序列的結尾。 您可以將資料分割視為一種「認可記錄」。

分割區會保有事件資料，資料中則包含事件的主體、會描述事件的使用者定義屬性包，以及中繼資料 (例如其在分割區的位移、其在串流序列的編號，以及接受事件時的服務端時間戳記)。

![顯示事件序列 (從舊到新) 的圖表。](./media/event-hubs-partitions/partition.png)

設計出事件中樞是為了協助處理大量的事件，而分割可從兩個方面提供協助：

首先，即使事件中樞是 PaaS 服務，其底下仍有實體現實，若要保存記錄以保留事件的順序，就需要將這些事件一起保存在基礎儲存體及其複本中，而這便導致了這類記錄的輸送量上限。 分割可讓您將多個平行記錄用於相同的事件中樞，因此讓可用的原始 IO 輸送量容量倍增。

其次，您自有應用程式的事件處理能力必須能夠跟上要傳送到事件中樞的事件量。 這可能會非常複雜，因此需要大量已擴增的平行處理容量。 分割區的原理與上述相同：單一程序處理事件的容量有限，因此您需要數個程序，而分割區則可供您的解決方案饋送這些程序，同時確保每個事件都有明確的處理擁有者。 

事件中樞會將事件保留一段已設定好的保留時間，這段時間在所有分割區上都一樣。 達到保留期間時，系統就會自動移除事件。 如果您指定的保留期間是一天，則在接受事件後，事件會在整整 24 小時內變成無法使用的狀態。 您無法明確地刪除事件。 

事件中樞標準版所允許的保留時間長達 7 天，事件中樞專用版則長達 90 天。 如果您需要將事件封存超過允許的保留期間，則可以[藉由開啟事件中樞擷取功能將事件自動儲存到 Azure 儲存體或 Azure Data Lake 中](../articles/event-hubs/event-hubs-capture-overview.md)，如果您需要搜尋或分析這類深層封存，則可以[輕鬆地將封存匯入至 Azure Synapse](../articles/event-hubs/store-captured-data-data-warehouse.md) 或其他類似的存放區和分析平台。 

事件中樞之所以會根據時間來限制資料保留期限，原因是為了避免大量的過往客戶資料深陷在存放區中，而只用時間戳記編製索引，並只允許循序存取。 此處的架構原理是過往資料的索引編製和存取方式，必須比事件中樞或 Kafka 所提供的即時事件介面更豐富和更直接。 事件串流引擎並不適合用來扮演事件來源的資料湖或長期封存角色。 

資料分割各自獨立，只包含其本身的資料序列，通常會以不同的速度成長。 在事件中樞中，並沒有需要系統管理員介入的問題，因為這會在 Apache Kafka 中 (舉例而言)，但分佈不均將會導致下游事件處理器的負載不平均。

![事件中樞](./media/event-hubs-partitions/multiple-partitions.png)

在事件中樞標準版中，分割區數量是在建立時指定，值必須介於 1 到 32 之間。 在事件中樞專用版中，分割區計數最多可達每個容量單位有 2000 個分割區。 

建議您在選擇分割區數量時，應符合該特定事件中樞的應用程式尖峰負載期間所預期持續的[輸送量單位 (TU)](../articles/event-hubs/event-hubs-faq.md#what-are-event-hubs-throughput-units) 所需的數量。 在計算時，請以單一分割區有 1 TU (1 MB 輸入，2 MB 輸出) 的輸送量容量作為單位。 您可以在命名空間或叢集的容量單位 (與分割區計數無關) 上調整 TU。 當命名空間設定為 1 TU 容量時，具有 32 個分割區的事件中樞或具有 1 個分割區的事件中樞會產生完全相同的成本。 

應用程式會以下列三種方式之一控制事件與分割區的對應：

- 藉由指定分割區索引鍵，這會一致地對應 (使用雜湊函式) 到其中一個可用的分割區。 
- 藉由不指定分割區索引鍵，這可讓訊息代理程式隨機選擇給定事件的分割區。
- 藉由明確地將事件傳送到特定分割區。

指定分割區索引鍵可讓相關事件以其確切的傳送順序一起保存在相同的分割區中。 分割區索引鍵是衍生自應用程式內容的某個字串，可識別事件的相互關係。

分割區索引鍵所識別的一連串事件便是 *串流*。 分割區是許多這類串流的多工記錄存放區。 

[專用的事件中樞叢集](../articles/event-hubs/event-hubs-dedicated-overview.md)中事件中樞的分割區計數可以在建立事件中樞後予以[增加](../articles/event-hubs/dynamically-add-partitions.md)，但分割區中的串流分佈，則會在完成時隨著分割區索引鍵與分割區的對應有所變更而跟著變更，因此如果事件的相對順序在您的應用程式中很重要，就請試著盡量避免這類變更。

將分割區數量設定為所允許的最大值雖然是誘人的方式，但請務必記住，事件串流必須有良好的結構，才能確實地利用好多個分割區。 如果您需要讓所有事件或只在少量子串流以絕對順序進行保留，則不一定能夠利用好多個分割區。 此外，多個分割區會讓處理層面變得更複雜。 

雖然可以直接傳送至分割區，但不建議這麼做。 相反地，您可以使用[事件發佈者](../articles/event-hubs/event-hubs-features.md#event-publishers)一節中介紹的較高階結構。 

如需資料分割和取捨可用性和可靠性的詳細資訊，請參閱[事件中樞程式設計指南](../articles/event-hubs/event-hubs-programming-guide.md#partition-key)和[事件中樞的可用性和一致性](../articles/event-hubs/event-hubs-availability-and-consistency.md)文章。
