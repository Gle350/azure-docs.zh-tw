---
title: 預估容量和成本
titleSuffix: Azure Cognitive Search
description: 查看評估容量及管理搜尋服務成本的指引，包括 Azure 中的基礎結構和工具，以及更有效使用資源的最佳作法。
manager: nitinme
author: HeidiSteen
ms.author: heidist
ms.service: cognitive-search
ms.topic: conceptual
ms.date: 12/15/2020
ms.openlocfilehash: d48ae71a979a2d0f1457b0cefa8a98a02710dd96
ms.sourcegitcommit: 77ab078e255034bd1a8db499eec6fe9b093a8e4f
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/16/2020
ms.locfileid: "97577641"
---
# <a name="how-to-estimate-capacity-and-costs-of-an-azure-cognitive-search-service"></a>如何預估 Azure 認知搜尋服務的容量和成本

在 Azure 認知搜尋的容量規劃過程中，下列指引可協助您降低成本或更有效率地管理成本：

+ 在相同的區域中建立所有資源，或盡可能減少最少的區域，以最小化或消除頻寬費用。

+ 將所有服務合併成一個資源群組，例如 Azure 認知搜尋、認知服務，以及解決方案中使用的任何其他 Azure 服務。 在 Azure 入口網站中，尋找資源群組，並使用 **成本管理** 命令，深入瞭解實際和預估的費用。

+ 針對您的前端應用程式考慮 Azure Web 應用程式，讓要求和回應保持在資料中心界限內。

+ 擴大大量資源的作業（例如編制索引），然後針對一般查詢工作負載重新調整。 從 Azure 認知搜尋的最小設定開始， (由一個磁碟分割和一個複本) 組成的 SU，然後監視使用者活動，以找出表示需要更多容量的使用模式。 如果有可預測的模式，您可以將調整與活動同步處理 (您必須撰寫程式碼，才能將此) 自動化。

[選擇定價層](search-sku-tier.md)會說明可計費的事件、帳單公式和可計費費率。 此外，您可以流覽 [帳單和成本管理](../cost-management-billing/cost-management-billing-overview.md) ，以取得與消費相關的內建工具和功能。

不可能暫時關閉搜尋服務。 專用資源一律可運作，並配置給您的服務存留期專屬使用。 刪除服務是永久性的，也會刪除其相關聯的資料。

就服務本身而言，降低帳單的唯一方法是將複本和資料分割縮減為仍提供可接受效能和 [SLA 合規性](https://azure.microsoft.com/support/legal/sla/search/v1_0/)的層級，或在較低層建立服務， (S1 每小時費率低於 S2 或 S3 費率) 。 如果您在負載預測的下半部布建服務，則在超出服務時，您可以建立第二個較大的分層服務，在第二個服務上重建索引，然後刪除第一個服務。

## <a name="how-to-evaluate-capacity-requirements"></a>如何評估容量需求

在 Azure 認知搜尋中，容量會結構化為複本 *和資料* 分割。

+ 複本是搜尋服務的實例。 每個複本都會裝載一個負載平衡的索引複本。 例如，具有六個複本的服務會在服務中載入每個索引的六個複本。

+ 分割區會儲存索引並自動分割可搜尋的資料。 兩個數據分割會將索引分割成半個，三個分割區分成三個，依此類推。 就容量而言，資料 *分割大小* 是各層之間的主要區別功能。

> [!NOTE]
> 所有標準和儲存體優化層都支援 [彈性的複本和](search-capacity-planning.md#chart) 資料分割組合，讓您可以藉由變更餘額來 [優化系統的速度或儲存體](search-performance-optimization.md) 。 基本層最多可為高可用性提供三個複本，但只有一個資料分割。 免費層不提供專屬資源：計算資源是由多個訂閱者所共用。

### <a name="evaluating-capacity"></a>評估容量

開始執行服務的容量和成本。 階層會限制兩個層級：儲存體和內容 (索引數目，例如) 。 您應該考慮這兩者的原因，因為您最先達到的限制是有效的限制。

商務需求通常會規定您需要的索引數目。 例如，您可能需要大型檔儲存機制的全域索引。 或者，您可能需要多個根據區域、應用程式或業務小的索引。

若要判斷索引的大小，您必須[建置一個](search-what-is-an-index.md)索引。 其大小會以匯入的資料和索引設定為基礎，例如您是否啟用建議工具、篩選和排序。

針對全文檢索搜尋，主要資料結構是 [反向索引](https://en.wikipedia.org/wiki/Inverted_index) 結構，其具有與來源資料不同的特性。 對於反向索引，大小和複雜度是由內容所決定，而不一定是您饋送至其中的資料量。 具有高冗余性的大型資料來源可能會產生比包含高度變數內容的較小資料集更小的索引。 因此很少可以根據原始資料集的大小推斷索引大小。

> [!NOTE] 
> 雖然預估索引和儲存空間的未來需求可能會像是猜測，但還是值得一試。 如果層的容量太低，您將需要在較高的層級布建新的服務，然後 [重載您的索引](search-howto-reindex.md)。 沒有將服務從一個階層就地升級到另一個層級。
>

## <a name="estimate-with-the-free-tier"></a>使用免費層進行評估

其中一個預估容量的方法是從免費層開始。 請記住，免費服務提供最多三個索引、50 MB 的儲存空間，以及2分鐘的索引時間。 使用這些條件約束來估計投影的索引大小可能會很困難，但這些步驟如下：

+ [建立免費服務](search-create-service-portal.md)。
+ 準備小型、具代表性的資料集。
+ [在入口網站中建立初始索引](search-get-started-portal.md) ，並記下其大小。 功能和屬性會影響儲存體。 例如，新增建議工具 (搜尋即輸入查詢) 將會增加儲存需求。 使用相同的資料集，您可能會嘗試在每個欄位上建立具有不同屬性的多個索引版本，以查看儲存需求的差異。 如需詳細資訊，請參閱 [建立基本索引中的「存放裝置含意](search-what-is-an-index.md#index-size)」。

有了粗略的估計值，您可以將兩個索引的數量加倍 (開發和生產) ，然後據以選擇您的定價層。

## <a name="estimate-with-a-billable-tier"></a>使用可計費層進行估計

專用資源可以容納較大型的取樣和處理時間，以在開發期間更實際估計索引數量、大小和查詢量。 某些客戶會直接使用計費層，然後在開發專案成熟時重新評估。

1. [查看每一層的服務限制](./search-limits-quotas-capacity.md#index-limits) ，判斷較低的層級是否可以支援您需要的索引數目。 在基本、S1 和 S2 層中，索引限制分別為15、50和200。 儲存體優化層有10個索引的限制，因為它的設計是為了支援少量的極大型索引。

1. [在可計費的定價層建立服務](search-create-service-portal.md)：

    + 如果您不確定預計的負載，請在 [基本] 或 [S1] 上啟動。
    + 如果您知道您將會有大規模的索引和查詢負載，請從 S2 或甚至 S3 開始。
    + 如果您要編制大量資料的索引，且查詢負載相對較低（如同內部商務應用程式），請從 L1 或 L2 的儲存體進行優化。

1. [建置初始索引](search-what-is-an-index.md)，以判斷來源資料轉譯為索引的情形。 這是唯一能預估索引大小的方式。

1. 在入口網站中[監視儲存體、服務限制、查詢量和延遲](search-monitor-usage.md)。 入口網站會顯示每秒查詢數、節流查詢和搜尋延遲。 所有這些值都可以協助您決定是否選取了正確的層級。 

索引編號和大小對您的分析同樣重要。 這是因為最大限制是透過儲存體 (分割區的充分利用) 或依資源 (索引、) 索引子等等的最大限制來達到，視何者先達到。 入口網站可協助您追蹤這兩項，在 [概觀] 頁面上並排顯示目前的使用量和最大限制。

> [!NOTE]
> 如果檔包含無關的資料，則可以擴大儲存體需求。 在理想情況下，檔只包含搜尋體驗所需的資料。 二進位資料無法搜尋，而且應該個別儲存 (可能在 Azure 資料表或 blob 儲存體) 中。 接著，應該在索引中加入欄位，以保存外部資料的 URL 參考。 如果您要在單一) 要求中大量上傳多份檔，則個別檔的大小上限為 16 MB (或較少。 如需詳細資訊，請參閱 [Azure 認知搜尋中的服務限制](search-limits-quotas-capacity.md)。
>

**查詢量的考量**

每秒查詢數 (QPS) 是效能調整期間的重要計量，但如果您在一開始就預期會有大量的查詢量，通常只會考慮階層。

標準層可以提供複本和資料分割的平衡。 您可以藉由新增負載平衡的複本或加入資料分割以進行平行處理，來增加查詢週期。 然後，您可以在布建服務之後調整效能。

如果您預期從一開始就會有高度持續的查詢磁片區，您應該考慮較高的標準層，並支援更強大的硬體。 然後，您可以讓分割區和複本離線，或甚至切換至較低層的服務（如果沒有發生這些查詢磁片區）。 如需如何計算查詢輸送量的詳細資訊，請參閱 [Azure 認知搜尋效能和優化](search-performance-optimization.md)。

儲存體優化層適用于大型資料工作負載，當查詢延遲需求較不重要時，支援更多的整體可用索引儲存體。 您仍應使用額外的複本來進行負載平衡，並使用額外的資料分割來進行平行處理。 然後，您可以在布建服務之後調整效能。

**服務等級協定**

免費層和預覽功能不提供 [服務等級協定 (sla) ](https://azure.microsoft.com/support/legal/sla/search/v1_0/)。 在所有可計費層中，SLA 會在您為您的服務佈建足夠的備援性時生效。 您需要有兩個以上的複本，查詢 (讀取) Sla。 您需要有三個以上的複本，以便查詢和編制索引 (讀寫) Sla。 磁碟分割數目不會影響 Sla。

## <a name="tips-for-tier-evaluation"></a>定價層評估秘訣

+ 允許計量以查詢為依據，並收集在上班時間 (查詢的使用模式資料，在離峰時段編制索引) 。 使用此資料來通知服務布建決策。 雖然不是每小時或每日的頻率，您可以動態調整分割區和資源，以配合查詢磁片區中的規劃變更。 如果層級保有足夠的時間足以保證採取動作，您也可以容納未計畫但持續的變更。

+ 請記住，在布建下的唯一缺點是，如果實際需求大於您的預測，您可能必須卸載服務。 為了避免服務中斷，您會在較高的層級建立新的服務，並並存執行，直到所有應用程式和要求都以新端點為目標為止。

## <a name="next-steps"></a>後續步驟

從免費層開始，然後使用您的資料子集來建立初始索引，以瞭解其特性。 Azure 認知搜尋中的資料結構是反向索引結構。 反向索引的大小和複雜性取決於內容。 請記住，重複性高的內容所產生的索引，往往會比差異性高的內容所產生的索引小。 因此，內容特性（而不是資料集大小）會決定索引儲存體需求。

當您有索引大小的初始估計值之後，請在本文討論的其中一個層級上布建可 [計費服務](search-create-service-portal.md) ：基本、標準或儲存體優化。 放寬對資料大小調整的任何人為限制，並 [重建您的索引](search-howto-reindex.md) ，以包含您想要搜尋的所有資料。

視需要[配置資料分割和複本](search-capacity-planning.md)，以取得所需的效能和規模。

如果效能和容量都沒問題，您就完成了。 否則，請在更符合需求的不同定價層重新建立搜尋服務。

> [!NOTE]
> 如果您有任何問題，請張貼至 [StackOverflow](https://stackoverflow.com/questions/tagged/azure-search) 或 [聯絡 Azure 支援](https://azure.microsoft.com/support/options/)。